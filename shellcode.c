#include <stdio.h>
#include <string.h>
#include <sys/mman.h>

//ligne test pour faire "hello world"
//unsigned char code[] = \/
//"\xeb\x17\x31\xc0\xb0\x04\x31\xdb\xb3\x01\x59\x31\xd2\xb2\x0d\xcd\x80\x31\xc0\xb0\x01\x31\xdb\xcd\x80\xe8\xe4\xff\xff\xff\x48\x65\x6c\x6c\x6f\x20\x57\x6f\x72\x6c\x64\x21\x0a";

unsigned char code[] = \
"\xeb\x17\x31\xc0\xb0\x04\x31\xdb\xb3\x01\x59\x31\xd2\xb2\x0d\xcd\x80\x31\xc0\xb0\x01\x31\xdb\xcd\x80\xe8\xe4\xff\xff\xff\x48\x65\x6c\x6c\x6f\x20\x57\x6f\x72\x6c\x64\x21\x0a";
void main()
{

    printf("Shellcode Length:  %d\n", strlen(code));

    int r = mprotect((void *)((int)code & ~4095), 4096, PROT_READ | PROT_WRITE | PROT_EXEC);
    printf("mprotect: %d\n", r);
    int (*ret)() = (int (*)())code;
    ret();
}